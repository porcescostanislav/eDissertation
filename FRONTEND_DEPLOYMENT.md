# Frontend Deployment Guide

This guide covers deploying the eDissertation React frontend to various platforms.

## Prerequisites

- Node.js 16+ and npm 7+
- Git repository pushed to GitHub
- Built `dist` folder (generated by `npm run build`)
- Backend API running and accessible

---

## Environment Variables

Frontend uses Vite environment variables (must start with `VITE_` prefix):

```bash
# .env.local
VITE_API_URL=https://api.yourdomain.com/api
VITE_NODE_ENV=production
```

**Important**: All `VITE_*` variables are bundled at build time and become public. Never put secrets in these variables.

---

## 1. Heroku Deployment

### Prerequisites
- Heroku CLI installed
- GitHub repository with frontend code

### Steps

```bash
# Login to Heroku
heroku login

# Create new Heroku app
heroku create edissertation-frontend

# Set environment variables
heroku config:set VITE_API_URL=https://edissertation-api.herokuapp.com/api

# For Node buildpack (recommended for React)
# Create or update Procfile in frontend directory
echo "web: npm install && npm run build && npx serve -s dist -l $PORT" > frontend/Procfile

# Deploy
cd frontend
git subtree push --prefix frontend heroku main
# Or if not using subtree:
heroku git:remote -a edissertation-frontend
git push heroku main

# View deployment
heroku open
```

### Buildpack Configuration

```bash
# Set Node buildpack
heroku buildpacks:set heroku/nodejs -a edissertation-frontend

# If using custom buildpack for SPA
heroku buildpacks:set mars/create-react-app -a edissertation-frontend
```

---

## 2. Render Deployment

### Steps

1. **Create Static Site in Render Dashboard**
   - New → Static Site
   - Connect GitHub repository
   - Select `frontend` directory (if monorepo)

2. **Configure Build Settings**
   - Build command: `npm run build`
   - Publish directory: `dist`

3. **Set Environment Variables**
   - Dashboard → Environment
   - Add: `VITE_API_URL=https://edissertation-api.onrender.com/api`

4. **Deploy**
   - Click "Deploy" button
   - Render automatically rebuilds on git push

### Manual Deployment

```bash
# Using render.yaml (create in root)
services:
  - type: web
    name: edissertation-frontend
    env: static
    buildCommand: cd frontend && npm install && npm run build
    staticPublishPath: frontend/dist
    routes:
      - path: /
        matchType: prefix
        rewritePath: /index.html
    envVars:
      - key: VITE_API_URL
        scope: build
        value: https://edissertation-api.onrender.com/api
```

---

## 3. Vercel Deployment (Recommended for React)

### Steps

1. **Sign up at vercel.com** with GitHub account

2. **Import Frontend Repository**
   - Dashboard → Add New → Project
   - Select GitHub repository
   - Select `frontend` directory

3. **Configure Build Settings**
   - Framework: React
   - Build Command: `npm run build`
   - Output Directory: `dist`

4. **Set Environment Variables**
   - Settings → Environment Variables
   - Add: `VITE_API_URL=https://api.yourdomain.com/api`

5. **Deploy**
   - Vercel automatically deploys on push to main

### vercel.json Configuration

```json
{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "framework": "react",
  "env": {
    "VITE_API_URL": "@vite_api_url"
  }
}
```

---

## 4. AWS Amplify Deployment

### Setup

```bash
# Install Amplify CLI
npm install -g @aws-amplify/cli

# Configure Amplify
amplify configure

# Initialize Amplify in frontend directory
cd frontend
amplify init

# Add hosting
amplify add hosting
# Select: Hosting with Amplify Console
# Build settings: use default
```

### Deploy

```bash
# Deploy frontend
amplify publish

# View logs
amplify console hosting
```

---

## 5. Netlify Deployment

### Via CLI

```bash
# Install Netlify CLI
npm install -g netlify-cli

# Build frontend
npm run build

# Deploy
netlify deploy --prod --dir=dist
```

### Via Dashboard

1. Sign up at netlify.com with GitHub
2. New site from Git
3. Select repository
4. Build command: `npm run build`
5. Publish directory: `dist`
6. Set environment variable: `VITE_API_URL`
7. Deploy

---

## 6. GitHub Pages Deployment

### Steps

```bash
# Install gh-pages package
npm install --save-dev gh-pages

# Update package.json
# Add to scripts:
# "deploy": "npm run build && gh-pages -d dist"
# Add: "homepage": "https://username.github.io/eDissertation"

# Deploy
npm run deploy

# Enable GitHub Pages in repository settings
# Select gh-pages branch as source
```

### Configuration

```json
{
  "homepage": "https://username.github.io/eDissertation",
  "scripts": {
    "deploy": "npm run build && gh-pages -d dist"
  }
}
```

---

## 7. Docker Deployment

### Build Docker Image

```bash
# Build image
docker build -t edissertation-frontend:1.0.0 .

# Run locally
docker run -p 3000:3000 edissertation-frontend:1.0.0

# View at http://localhost:3000
```

### Docker Compose

```bash
# Start full stack (from root directory)
docker-compose up -d

# Frontend available at http://localhost:5173
# Stop
docker-compose down
```

### Push to Docker Registry

```bash
# Tag image
docker tag edissertation-frontend:1.0.0 username/edissertation-frontend:1.0.0

# Login to Docker Hub
docker login

# Push
docker push username/edissertation-frontend:1.0.0

# Deploy from registry
docker run -p 3000:3000 username/edissertation-frontend:1.0.0
```

---

## 8. Self-Hosted (Nginx)

### Setup

```bash
# SSH to server
ssh root@your-server-ip

# Install Node.js and npm
curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash -
sudo apt install nodejs -y

# Clone repository
git clone https://github.com/your-username/eDissertation.git
cd eDissertation/frontend

# Install dependencies
npm install

# Build
npm run build

# Install Nginx
sudo apt install nginx -y
```

### Nginx Configuration

```nginx
server {
    listen 80;
    server_name yourdomain.com;
    
    # Redirect HTTP to HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name yourdomain.com;
    
    # SSL certificates
    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;
    
    # Root directory
    root /home/ubuntu/eDissertation/frontend/dist;
    index index.html;
    
    # SPA routing
    location / {
        try_files $uri /index.html;
    }
    
    # Cache static assets
    location ~* \.(js|css|png|jpg|jpeg|gif|svg|woff|woff2)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
    
    # Proxy API requests to backend
    location /api/ {
        proxy_pass http://localhost:3000/api/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # Disable access to sensitive files
    location ~ /\. {
        deny all;
    }
}
```

### Enable and Restart

```bash
# Test configuration
sudo nginx -t

# Enable site
sudo ln -s /etc/nginx/sites-available/edissertation /etc/nginx/sites-enabled/

# Restart Nginx
sudo systemctl restart nginx

# Setup SSL (Let's Encrypt)
sudo apt install certbot python3-certbot-nginx -y
sudo certbot certonly --nginx -d yourdomain.com

# Auto-renew certificates
sudo systemctl enable certbot.timer
sudo systemctl start certbot.timer
```

---

## Performance Optimization

### 1. Enable Gzip Compression

```nginx
# In nginx.conf
gzip on;
gzip_types text/plain text/css text/javascript application/json application/javascript image/svg+xml;
gzip_min_length 256;
```

### 2. Implement Caching Strategy

- Static assets: 30 days cache
- HTML files: No cache (or short cache)
- API requests: No cache

### 3. CDN Integration

```nginx
# Serve static assets from CDN
# Update asset URLs in build process or HTML
# Example with Cloudflare:
# - DNS points to Cloudflare
# - Assets cached at edge locations
# - Reduced latency and bandwidth costs
```

### 4. Code Splitting

Vite automatically code-splits React components:
```javascript
// Lazy load components
const StudentDashboard = lazy(() => import('./pages/StudentDashboard'));
const ProfesorDashboard = lazy(() => import('./pages/ProfesorDashboard'));
```

### 5. Image Optimization

```javascript
// Use optimized image formats
<img src="image.webp" alt="description" />
<source srcset="image.webp" type="image/webp" />
<source srcset="image.jpg" type="image/jpeg" />
```

---

## Monitoring & Logging

### Frontend Error Tracking

```javascript
// Sentry integration for error monitoring
import * as Sentry from "@sentry/react";

Sentry.init({
  dsn: "your-sentry-dsn",
  environment: process.env.VITE_NODE_ENV,
});
```

### Access Logs (Nginx)

```bash
# View Nginx access logs
sudo tail -f /var/log/nginx/access.log

# View error logs
sudo tail -f /var/log/nginx/error.log
```

### Build Logs

```bash
# View Vercel build logs
vercel logs --prod

# View Netlify build logs
netlify log --prod

# View Heroku build logs
heroku logs --tail
```

---

## Troubleshooting

### 1. Build Fails

```bash
# Clear cache and rebuild
rm -rf node_modules dist
npm install
npm run build

# Check build output
npm run build -- --debug
```

### 2. Blank White Page

```bash
# Check browser console for errors
# Verify VITE_API_URL is set correctly
# Check if backend is accessible
curl https://api.yourdomain.com/api/health

# Verify index.html is served for all routes
# Check Nginx/server configuration
```

### 3. CORS Errors

```bash
# Verify backend CORS configuration
# Check FRONTEND_URL matches deployment domain
# Verify backend is accessible from frontend domain
```

### 4. API Calls Return 404

```bash
# Verify VITE_API_URL includes /api
# Example: https://api.yourdomain.com/api (correct)
#          https://api.yourdomain.com (incorrect)

# Check backend routes are properly prefixed
```

### 5. Static Assets Not Loading

```bash
# Check asset paths in dist folder
ls -la dist/

# Verify Nginx is serving from correct root directory
# Check browser DevTools Network tab for 404 errors

# Common issue: relative vs absolute paths
# Use: import logo from './assets/logo.png'
# Not: import logo from '/assets/logo.png'
```

---

## Deployment Checklist

- [ ] All environment variables set correctly
- [ ] Build completes without errors
- [ ] Application runs locally with `npm run dev`
- [ ] API URL points to correct backend
- [ ] Authentication works (login/logout)
- [ ] File uploads work if applicable
- [ ] Responsive design works on mobile
- [ ] All pages load and navigate correctly
- [ ] Console has no errors
- [ ] Performance is acceptable (Lighthouse score)
- [ ] SSL certificate installed (if self-hosted)
- [ ] Backups configured (if applicable)
- [ ] Monitoring/logging configured
- [ ] Team informed of deployment

---

## Security Considerations

1. **Never commit .env.local** - Use .env.example
2. **No secrets in VITE_* variables** - They're bundled in frontend
3. **Enable HTTPS** for all deployments
4. **Set secure CORS headers** on backend
5. **Validate all user input** before sending to API
6. **Keep dependencies updated** - `npm audit`
7. **Use environment-specific API URLs**
8. **Implement rate limiting** on backend
9. **Store JWT tokens securely** (httpOnly cookies preferred)
10. **Regular security audits** of code and dependencies

---

## Performance Benchmarks

**Target Metrics:**
- Initial page load: < 3 seconds
- Time to Interactive (TTI): < 5 seconds
- Largest Contentful Paint (LCP): < 2.5 seconds
- Cumulative Layout Shift (CLS): < 0.1
- First Input Delay (FID): < 100ms

**Optimization Tools:**
- Google Lighthouse
- WebPageTest
- GTmetrix
- Bundle Analyzer: `npm run build -- --analyze`

---

## Platform Comparison

| Platform | Ease | Scalability | Cost | Best For |
|----------|------|-------------|------|----------|
| Vercel | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | Free tier | React/Next.js |
| Netlify | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | Free tier | Static sites |
| Render | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | Free tier | Full stack |
| Heroku | ⭐⭐⭐⭐ | ⭐⭐⭐ | Paid | Traditional apps |
| AWS Amplify | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | Pay-per-use | AWS ecosystem |
| Self-hosted | ⭐⭐ | ⭐⭐⭐⭐ | Server cost | Full control |
| Docker | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | Flexible | Any platform |

---

## Support Resources

- **Vite Docs**: https://vitejs.dev/
- **React Docs**: https://react.dev/
- **Axios**: https://axios-http.com/
- **Platform-specific docs**: See platform documentation
- **Community**: GitHub Discussions, Stack Overflow

---

**Last Updated**: December 2025
**Supported Platforms**: Heroku, Render, Vercel, AWS, Azure, Netlify, GitHub Pages, Docker

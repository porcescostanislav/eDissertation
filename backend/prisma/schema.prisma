// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id    Int     @id @default(autoincrement())
  email String  @unique
  passwordHash String @map("password_hash")
  role  Role
  createdAt DateTime @default(now()) @map("created_at")
  
  profesor Profesor?
  student Student?
  
  @@map("User")
}

enum Role {
  student
  profesor
  
  @@map("User_role")
}

model Profesor {
  id    Int     @id @default(autoincrement())
  userId Int @unique @map("user_id")
  nume  String
  prenume String
  limitaStudenti Int @default(0) @map("limita_studenti")
  createdAt DateTime @default(now()) @map("created_at")
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  sesiuneInscriere SesiuneInscriere[]
  cerereDisertatie CerereDisertatie[]
  
  @@index([nume, prenume])
  @@map("Profesor")
}

model Student {
  id    Int     @id @default(autoincrement())
  userId Int @unique @map("user_id")
  nume  String
  prenume String
  createdAt DateTime @default(now()) @map("created_at")
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  cerereDisertatie CerereDisertatie[]
  
  @@index([nume, prenume])
  @@map("Student")
}

model SesiuneInscriere {
  id    Int     @id @default(autoincrement())
  profesorId Int @map("profesor_id")
  dataInceput DateTime @map("data_inceput")
  dataSfarsit DateTime @map("data_sfarsit")
  limitaStudenti Int @map("limita_studenti")
  createdAt DateTime @default(now()) @map("created_at")
  
  profesor Profesor @relation(fields: [profesorId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  cerereDisertatie CerereDisertatie[]
  
  @@index([profesorId])
  @@index([dataInceput])
  @@index([dataSfarsit])
  @@map("SesiuneInscriere")
}

model CerereDisertatie {
  id    Int     @id @default(autoincrement())
  studentId Int @map("student_id")
  sesiuneId Int @map("sesiune_id")
  profesorId Int @map("profesor_id")
  status Status @default(pending)
  justificareRespingere String? @map("justificare_respingere") @db.Text
  fisierSemnatUrl String? @map("fisier_semnat_url") @db.VarChar(500)
  fisierRaspunsUrl String? @map("fisier_raspuns_url") @db.VarChar(500)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")
  
  student Student @relation(fields: [studentId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  sesiune SesiuneInscriere @relation(fields: [sesiuneId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  profesor Profesor @relation(fields: [profesorId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  
  @@unique([studentId, sesiuneId], map: "uk_student_sesiune")
  @@index([status])
  @@index([profesorId])
  @@index([createdAt])
  @@map("CerereDisertatie")
}

enum Status {
  pending
  approved
  rejected
  
  @@map("CerereDisertatie_status")
}
